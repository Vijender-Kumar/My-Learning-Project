Done some code optimization, use of functions.
